

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: sfdx-source/TMS/main/default/lwc/uploadFiles/uploadFiles.js | Shared Code Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 80px; height: 13px">
        
            <a href="https://targetrecruit.com" rel="noopener noreferrer" target="_blank">
                <img src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Shared Code Documentation</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <h2>Main</h2><div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-jest-tests.html">Jest Tests</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="jest-tests_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="CustomElement.html">CustomElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomElement_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomElement.html#initialError">initialError</a></li><li><a href="CustomElement.html#initialErrorLabel">initialErrorLabel</a></li><li><a href="CustomElement.html#initialLoading">initialLoading</a></li><li><a href="CustomElement.html#label">label</a></li><li><a href="CustomElement.html#loading">loading</a></li><li><a href="CustomElement.html#loadingGlobal">loadingGlobal</a></li><li><a href="CustomElement.html#messages">messages</a></li><li><a href="CustomElement.html#messagesGlobal">messagesGlobal</a></li><li><a href="CustomElement.html#ready">ready</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomElement.html#addError">addError</a></li><li><a href="CustomElement.html#addInfo">addInfo</a></li><li><a href="CustomElement.html#addSuccess">addSuccess</a></li><li><a href="CustomElement.html#addWarning">addWarning</a></li><li><a href="CustomElement.html#apex">apex</a></li><li><a href="CustomElement.html#closeWindow">closeWindow</a></li><li><a href="CustomElement.html#renderedOnceCallback">renderedOnceCallback</a></li></ul></div></li><li><a href="Messages.html">Messages</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Messages_sub"></div></li><li><span class="icon green">LWC</span>&nbsp;<a href="UploadFiles.html">UploadFiles</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UploadFiles_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UploadFiles.html#extensions">extensions</a></li><li><a href="UploadFiles.html#helpText">helpText</a></li><li><a href="UploadFiles.html#label">label</a></li><li><a href="UploadFiles.html#multiple">multiple</a></li><li><a href="UploadFiles.html#required">required</a></li><li><a href="UploadFiles.html#type">type</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UploadFiles.html#checkValidity">checkValidity</a></li><li><a href="UploadFiles.html#hasErrorMessage">hasErrorMessage</a></li><li><a href="UploadFiles.html#reportValidity">reportValidity</a></li><li><a href="UploadFiles.html#setCustomValidity">setCustomValidity</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="UploadFiles.html#event:upload">upload</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Mixins</h3><ul><li><a href="CustomInput.html">CustomInput</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomInput_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomInput.html#.controlClass">controlClass</a></li><li><a href="CustomInput.html#.helpMessage">helpMessage</a></li><li><a href="CustomInput.html#.required">required</a></li><li><a href="CustomInput.html#.value">value</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomInput.html#.checkValidity">checkValidity</a></li><li><a href="CustomInput.html#.hasErrorMessage">hasErrorMessage</a></li><li><a href="CustomInput.html#.reportValidity">reportValidity</a></li><li><a href="CustomInput.html#.setCustomValidity">setCustomValidity</a></li><li><a href="CustomInput.html#.validate">validate</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li class="hidden"><a href="global.html#Message">Message</a></li><li><a href="global.html#Severity">Severity</a></li></ul></div><h2>Testing</h2><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="JestHtmlElement.html">JestHtmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="JestHtmlElement_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="JestHtmlElement.html#.dispatch">dispatch</a></li><li><a href="JestHtmlElement.html#.listen">listen</a></li><li><a href="JestHtmlElement.html#.query">query</a></li><li><a href="JestHtmlElement.html#.queryAll">queryAll</a></li></ul></div></li><li><a href="SharedTestHelpers.html">SharedTestHelpers</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="SharedTestHelpers.html#.staticData">staticData</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="SharedTestHelpers.html#.apexMock">apexMock</a></li><li><a href="SharedTestHelpers.html#.createComponent">createComponent</a></li><li><a href="SharedTestHelpers.html#.flushPromises">flushPromises</a></li><li><a href="SharedTestHelpers.html#.getMessages">getMessages</a></li></ul></div></li><li><a href="SharedTestHelpers.Timer.html">Timer</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers.Timer_sub"></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// CC: 7.3. Custom labels:
//Eiswari: Fixed
import {api} from 'lwc';
import CustomInput from "c/customInput";
import CustomElement from "c/customElement";

import {loadScript} from 'lightning/platformResourceLoader';
import ZIP_JS from '@salesforce/resourceUrl/zipJs';
import labelUpload_File_Zip_Error from '@salesforce/label/c.Upload_File_Zip_Error';
import labelUpload_File_Multiple_Error from '@salesforce/label/c.Upload_File_Multiple_Error';
import labelFile_type_is_invalid from '@salesforce/label/c.File_type_is_invalid';
import labelAllowed_file_types from '@salesforce/label/c.Allowed_file_types';

/**
 * @mixes CustomInput
 * @hideconstructor
 * @lwc
 */
class UploadFiles extends CustomInput(CustomElement) {
	/**
	 *
	 * @type String
	 */
	@api label = ``;
	
	/**
	 *
	 * @type String
	 * @description A comma-separated list of file extensions which are allowed to upload.
	 */
	@api extensions;
	
	/**
	 *
	 * @type Boolean
	 * @default false
	 */
	@api multiple = false;
	
	/**
	 * @type String
	 * @summary Possible values are `null` or `'text'` or `'base64'`.
	 * @default null
	 * @description Content type of the files to be passed to {@link UploadFiles#upload} event. Converted content is sent to listeners of the {@link UploadFiles#upload} event via custom `.content` field of the [File]{@link https://developer.mozilla.org/en-US/docs/Web/API/File}.
	 */
	@api type = ``;
	
	/**
	 *
	 * @type Boolean
	 * @default false
	 */
	@api required = false;
	
	/**
	 *
	 * @type String
	 */
	@api helpText = ``;
	
	fileNameToDisplay;
	
	__dragCounter = 0;
	
	value = null;
	
	async connectedCallback() {
		try {
			await Promise.all([
				loadScript(this, ZIP_JS + '/zip.js'),
				loadScript(this, ZIP_JS + '/deflate.js'),
				loadScript(this, ZIP_JS + '/inflate.js'),
			]);
			
			zip.useWebWorkers = false;
		} catch (e) {
			this.addError(e);
		}
	}
	
	handleDragEnter(event) {
		event.preventDefault();
		
		this.setDropZoneStyle(true);
	}
	
	handleDragLeave(event) {
		event.preventDefault();
		
		this.setDropZoneStyle(false);
	}
	
	handleDragOver(event) {
		event.preventDefault();
	}
	
	setDropZoneStyle(isEnter) {
		let backgroundColor = isEnter ? 'lightblue' : 'white';
		
		let incDec = isEnter ? 1 : -1;
		
		this.__dragCounter += incDec;
		
		if (isEnter || (!isEnter &amp;&amp; this.__dragCounter === 0)) {
			let dropZone = this.template.querySelector('.drop-zone');
			dropZone.style.background = backgroundColor;
		}
	}
	
	async handleFileChanged(event) {
		await this.processFiles(event.detail.files);
	}
	
	async handleDrop(event) {
		event.preventDefault();
		this.setDropZoneStyle(false);
		
		await this.processFiles(event.dataTransfer.files);
	}
	
	async processFiles(files) {
		this.loading = true;
		
		this.value = null;
		
		files = Array.from(files);
		if (files.length === 0) {
			return;
		}
		
		let zipFound = false;
		for (const file of files) {
			if (this.isZip(file)) {
				zipFound = true;
				break;
			}
		}
		
		this.__errors = [];
		if (zipFound) {
			if (files.length > 1) {
				this.__errors.push(labelUpload_File_Zip_Error);
			} else {
				files = await this.extractFromZip(files[0]);
			}
		}
		
		if (!this.multiple &amp;&amp; files.length > 1) {
			this.__errors.push(labelUpload_File_Multiple_Error);
		}
		
		const extensions = this.extensions?.split(`,`).map(extension => extension.trim());
		for (const file of files) {
			let extension = this.getFileExtension(file);
			if (extensions &amp;&amp; !extensions.includes(extension)) {
				this.__errors.push(
					`${file.name}: ` + labelFile_type_is_invalid +
					labelAllowed_file_types + `: ${this.extensions}`);
			}
		}
		
		this.value = files;
		
		this.fileNameToDisplay = ``;
		
		this.setCustomValidity(``);
		
		if (this.reportValidity()) {
			if (this.type) {
				for (const file of files) {
					file.content = await this.getContent(file);
				}
			}
			
			let asyncHandlers = [];
			
			/**
			 * @event UploadFiles#upload
			 * @property {object} detail
			 * @property {File[]} detail.files Contains a list of the uploaded [Files]{@link https://developer.mozilla.org/en-US/docs/Web/API/File}.
			 * @property {Promise[]} detail.asyncHandlers An empty list of Promises. If a listener of the event has some asynchronous process then the listener code body must be wrapped with a Promise and pushed to the {@link asyncHandlers} list. If the Promise's resolve function will be called with `true` value of the parameter then it will be considered as success. Otherwise, the event will be canceled. By canceled event it means the file will not be considered as uploaded and the file name will not be shown on the component's UI.
			 * #### Example
			 * ```javascript
handleFilesUpload(event) {
	event.detail.asyncHandlers.push(new Promise(resolve => {
		setTimeout(() => {
			// Approves the upload if the uploaded file's name is `valid.txt`.
			// Otherwise, cancels the event.
			resolve(event.detail.files[0].name === `valid.txt`);
		}, 1000);
	}));
}
			 * ```
			 */
			let canceled = !this.dispatchEvent(new CustomEvent('upload', {
				cancelable: true,
				detail: {
					files: files,
					asyncHandlers: {
						push: asyncHandler => asyncHandlers.push(asyncHandler)
					}
				}
			}));
			
			canceled = canceled
				|| (await Promise.all(asyncHandlers)).some(result => result === false);
			
			if (!canceled) {
				this.fileNameToDisplay = files.map((file) => {
					return file.name;
				}).join(', ');
			}
		}
		
		this.loading = false;
	}
	
	validate() {
		let parentMessage = super.validate();
		if (parentMessage) {
			return parentMessage;
		}
		
		return this.__errors &amp;&amp; this.__errors.length > 0 ? this.__errors[0] : ``;
	}
	
	isZip(file) {
		return this.getFileExtension(file) === 'zip';
	}
	
	getFileExtension(file) {
		let fileName = file.name;
		return fileName.substring((fileName.lastIndexOf('.') + 1));
	}
	
	extractFromZip(zipFile) {
		return new Promise((resolve) => {
			// use a BlobReader to read the zip from a Blob object
			zip.createReader(new zip.BlobReader(zipFile), reader => {
				// get all entries from the zip
				reader.getEntries(async entries => {
					let files = [];
					
					for (let entry of entries) {
						if (!entry.directory) {
							files.push(await this.getFileBody(entry));
						}
					}
					
					reader.close();
					
					resolve(files);
				});
			}, (e) => {
				this.addError(e);
			});
		});
	}
	
	getFileBody(entry) {
		return new Promise((resolve) => {
			entry.getData(new zip.BlobWriter(), (blob) => {
				blob.name = entry.filename.replace(/^.*[\\\/]/, '');
				resolve(blob);
			});
		});
	}
	
	getContent(file) {
		return new Promise((resolve) => {
			let reader = new FileReader();
			reader.onloadend = () => {
				if (this.type === `base64`) {
					resolve(reader.result.substring(reader.result.indexOf(',') + 1));
				} else if (this.type === `text`) {
					resolve(reader.result);
				}
			};
			
			if (this.type === `base64`) {
				reader.readAsDataURL(file);
			} else if (this.type === `text`) {
				reader.readAsText(file);
			}
		});
	}
}

export default UploadFiles;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" style="width: 80px; height: 13px">
    <div class="footer-text">2022</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
