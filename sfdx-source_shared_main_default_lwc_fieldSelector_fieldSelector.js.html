

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: sfdx-source/shared/main/default/lwc/fieldSelector/fieldSelector.js | Shared Code Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="styles/custom.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 80px; height: 13px">
        
            <a href="https://targetrecruit.com" rel="noopener noreferrer" target="_blank">
                <img src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Shared Code Documentation</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Tutorials</h4></a>
            </li>
        </ol>
    
    <h2>Main</h2><div class="lnb-examples hidden"><h3>Tutorials</h3><ul><li><a href="tutorial-jest-tests.html">Jest Tests</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="jest-tests_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="CustomElement.html">CustomElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomElement_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomElement.html#handlerInProgress">handlerInProgress</a></li><li><a href="CustomElement.html#initialError">initialError</a></li><li><a href="CustomElement.html#initialErrorLabel">initialErrorLabel</a></li><li><a href="CustomElement.html#initialLoading">initialLoading</a></li><li><a href="CustomElement.html#label">label</a></li><li><a href="CustomElement.html#loading">loading</a></li><li><a href="CustomElement.html#loadingGlobal">loadingGlobal</a></li><li><a href="CustomElement.html#messages">messages</a></li><li><a href="CustomElement.html#messagesGlobal">messagesGlobal</a></li><li><a href="CustomElement.html#ready">ready</a></li><li><a href="CustomElement.html#staticData">staticData</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomElement.html#addError">addError</a></li><li><a href="CustomElement.html#addInfo">addInfo</a></li><li><a href="CustomElement.html#addSuccess">addSuccess</a></li><li><a href="CustomElement.html#addWarning">addWarning</a></li><li><a href="CustomElement.html#apex">apex</a></li><li><a href="CustomElement.html#closeWindow">closeWindow</a></li><li><a href="CustomElement.html#connectedOnceCallback">connectedOnceCallback</a></li><li><a href="CustomElement.html#dispatchAsync">dispatchAsync</a></li><li><a href="CustomElement.html#renderedOnceCallback">renderedOnceCallback</a></li></ul></div></li><li><a href="Messages.html">Messages</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Messages_sub"></div></li><li><span class="icon green">LWC</span>&nbsp;<a href="UploadFiles.html">UploadFiles</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UploadFiles_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UploadFiles.html#audioFileSize">audioFileSize</a></li><li><a href="UploadFiles.html#baseFileSize">baseFileSize</a></li><li><a href="UploadFiles.html#contentType">contentType</a></li><li><a href="UploadFiles.html#documentFileSize">documentFileSize</a></li><li><a href="UploadFiles.html#fileTypes">fileTypes</a></li><li><a href="UploadFiles.html#helpText">helpText</a></li><li><a href="UploadFiles.html#imageFileSize">imageFileSize</a></li><li><a href="UploadFiles.html#multiple">multiple</a></li><li><a href="UploadFiles.html#noZip">noZip</a></li><li><a href="UploadFiles.html#parentId">parentId</a></li><li><a href="UploadFiles.html#required">required</a></li><li><a href="UploadFiles.html#selectFileLabel">selectFileLabel</a></li><li><a href="UploadFiles.html#size">size</a></li><li><a href="UploadFiles.html#uploadFileLabel">uploadFileLabel</a></li><li><a href="UploadFiles.html#videoFileSize">videoFileSize</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UploadFiles.html#checkValidity">checkValidity</a></li><li><a href="UploadFiles.html#getErrorMessage">getErrorMessage</a></li><li><a href="UploadFiles.html#hasErrorMessage">hasErrorMessage</a></li><li><a href="UploadFiles.html#reportValidity">reportValidity</a></li><li><a href="UploadFiles.html#setCustomValidity">setCustomValidity</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="UploadFiles.html#event:upload">upload</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Mixins</h3><ul><li><a href="CustomInput.html">CustomInput</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomInput_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomInput.html#.controlClass">controlClass</a></li><li><a href="CustomInput.html#.helpMessage">helpMessage</a></li><li><a href="CustomInput.html#.required">required</a></li><li><a href="CustomInput.html#.value">value</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomInput.html#.checkValidity">checkValidity</a></li><li><a href="CustomInput.html#.getErrorMessage">getErrorMessage</a></li><li><a href="CustomInput.html#.hasErrorMessage">hasErrorMessage</a></li><li><a href="CustomInput.html#.reportValidity">reportValidity</a></li><li><a href="CustomInput.html#.setCustomValidity">setCustomValidity</a></li><li><a href="CustomInput.html#.validate">validate</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li class="hidden"><a href="global.html#Message">Message</a></li><li><a href="global.html#Severity">Severity</a></li></ul></div><h2>Testing</h2><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="JestHtmlElement.html">JestHtmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="JestHtmlElement_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="JestHtmlElement.html#.apexMock">apexMock</a></li><li><a href="JestHtmlElement.html#.dispatch">dispatch</a></li><li><a href="JestHtmlElement.html#.isApexCalled">isApexCalled</a></li><li><a href="JestHtmlElement.html#.isEventDispatched">isEventDispatched</a></li><li><a href="JestHtmlElement.html#.isGenerated">isGenerated</a></li><li><a href="JestHtmlElement.html#.isNotGenerated">isNotGenerated</a></li><li><a href="JestHtmlElement.html#.listen">listen</a></li><li><a href="JestHtmlElement.html#.mock">mock</a></li><li><a href="JestHtmlElement.html#.query">query</a></li><li><a href="JestHtmlElement.html#.queryAll">queryAll</a></li><li><a href="JestHtmlElement.html#.queryUnique">queryUnique</a></li></ul></div></li><li><a href="SharedTestHelpers.html">SharedTestHelpers</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="SharedTestHelpers.html#.staticData">staticData</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="SharedTestHelpers.html#.apexMock">apexMock</a></li><li><a href="SharedTestHelpers.html#.createComponent">createComponent</a></li><li><a href="SharedTestHelpers.html#.flushPromises">flushPromises</a></li><li><a href="SharedTestHelpers.html#.getMessages">getMessages</a></li></ul></div></li><li><a href="SharedTestHelpers.Timer.html">Timer</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers.Timer_sub"></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {api} from 'lwc';
import CustomElement from "c/customElement";
import CustomInput from "c/customInput";

import getFields from '@salesforce/apex/FieldSelectorController.getFields';

export default class FieldSelector extends CustomInput(CustomElement) {
	@api label = ``;
	@api required = false;
	
	@api set objectType(val) {
		this.__objectType = val;
		
		if (this.__connected) {
			this.loadingAll = true;
			
			// noinspection JSIgnoredPromiseFromCall
			this.initFieldGroups();
			
			this.loadingAll = false;
		}
	};
	
	get objectType() {
		return this.__objectType;
	}
	
	/**
	 * Comma-separated list of field types available for selection. Possible values:
	 *    Boolean, Currency, Date, DateTime, Double, Email, ID, Integer, Long, MultiPicklist,
	 *    Percent, Phone, Picklist, Reference(Account;Contact;&lt;ObjectType1>), String, TextArea, URL.
	 * @type {string}
	 */
	@api fieldTypes = ``;
	
	@api set value(val) {
		this.__value = val;
		
		if (this.__connected) {
			this.loadingAll = true;
			
			// noinspection JSIgnoredPromiseFromCall
			this.selectFields(val);
			
			this.loadingAll = false;
		}
	};
	
	get value() {
		const selectedNames = [];
		let groupsWithSelectedFields = this.getSelectedGroups();
		for (let i = 0; i &lt; groupsWithSelectedFields.length; i++) {
			const fieldGroup = groupsWithSelectedFields[i];
			
			if (fieldGroup.selectedField) {
				let selectedField = fieldGroup.selectedField;
				
				if (i === groupsWithSelectedFields.length - 1 &amp;&amp; !selectedField.isSelectable) {
					return '';
				}
				
				selectedNames.push(i &lt; groupsWithSelectedFields.length - 1
					? selectedField.relationshipName
					: selectedField.name);
			}
		}
		
		return selectedNames.join(`.`);
	}
	
	fieldGroups = [];
	
	get groupsWithSelectedFields() {
		return this.value ? this.getSelectedGroups() : [];
	}
	
	getSelectedGroups() {
		return this.fieldGroups.filter(fieldGroup => fieldGroup.selectedField);
	}
	
	loadingAll = true;
	
	async connectedCallback() {
		try {
			this.__key = 1;
			
			const fieldTypes =
				this.fieldTypes.split(`,`).map(fieldType => fieldType.trim().toUpperCase());
			
			this.__fieldTypesFinal = [];
			for (const fieldType of fieldTypes) {
				if (fieldType.startsWith(`REFERENCE(`)) {
					const objectTypes = /^REFERENCE\((.+)\)$/
						.exec(fieldType)[1]
						.split(`;`)
						.map(fieldType => fieldType.trim());
					
					for (const objectType of objectTypes) {
						this.__fieldTypesFinal.push(`REFERENCE(${objectType})`);
					}
				} else {
					this.__fieldTypesFinal.push(fieldType);
				}
			}
			
			this.__connected = true;
			
			this.loadingAll = true;
			
			await this.initFieldGroups();
			
			if (this.__value) {
				await this.selectFields(this.__value);
			}
			
			this.loadingAll = false;
		} catch (e) {
			this.addError(e);
		}
	}
	
	async initFieldGroups() {
		try {
			this.fieldGroups = [await this.retrieveFieldGroup(this.objectType)];
		} catch (e) {
			this.addError(e);
		}
	}
	
	async selectFields(val) {
		try {
			let selectedFields = val.split(`.`);
			
			let fieldGroup = this.fieldGroups[0];
			
			for (let i = 0; i &lt; selectedFields.length; i++) {
				const fieldNameOrRelationshipName = selectedFields[i];
				
				let fields = fieldGroup.fields;
				let selectedField = i &lt; selectedFields.length - 1
					? fields.find(field => field.relationshipName === fieldNameOrRelationshipName)
					: fields.find(field => field.name === fieldNameOrRelationshipName);
				
				await this.selectNextField(fieldGroup, selectedField);
				
				fieldGroup = this.fieldGroups[this.fieldGroups.length - 1];
			}
			
			this.setCustomValidity(``);
			this.reportValidity();
		} catch (e) {
			this.addError(e);
		}
	}
	
	async retrieveFieldGroup(objectType) {
		const fieldGroup = {
			key: `` + this.__key++,
			fields: await this.apex(
				getFields, {objectType: objectType, fieldTypes: this.__fieldTypesFinal})
		};
		
		for (const field of fieldGroup.fields) {
			field.key = `` + this.__key++;
			
			field.selectLabel = field.label;
			if (field.type === `REFERENCE`) {
				field.selectLabel += ` >`;
			}
		}
		
		return fieldGroup;
	}
	
	async handleSelectOptionChanged(event) {
		let selectedSelect = event.currentTarget;
		
		let fieldGroup =
			this.fieldGroups.find(fieldGroup => fieldGroup.key === selectedSelect.dataset.key);
		
		const selectedValue = selectedSelect.options[selectedSelect.selectedIndex].value;
		
		let selectedField = fieldGroup.fields.find(field => field.name === selectedValue);
		
		await this.selectNextField(fieldGroup, selectedField);
		
		this.setCustomValidity(``);
		this.reportValidity();
	}
	
	async selectNextField(fieldGroup, selectedField) {
		fieldGroup.selectedField = selectedField;
		
		this.fieldGroups = this.fieldGroups.slice(0, this.fieldGroups.indexOf(fieldGroup) + 1);
		
		if (selectedField.type === `REFERENCE`) {
			this.fieldGroups.push(await this.retrieveFieldGroup(selectedField.objectType));
		}
		
		for (const field of fieldGroup.fields) {
			field.isSelected = false;
		}
		
		selectedField.isSelected = true;
		
		this.fieldGroups = [...this.fieldGroups];
	}
}

//# sourceURL=fieldSelector.js
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" style="width: 80px; height: 13px">
    <div class="footer-text">2023</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
