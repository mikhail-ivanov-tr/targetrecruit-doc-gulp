

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: test/shared.js | Shared Code Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="styles/custom.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 80px; height: 13px">
        
            <a href="https://targetrecruit.com" rel="noopener noreferrer" target="_blank">
                <img src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Shared Code Documentation</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Tutorials</h4></a>
            </li>
        </ol>
    
    <h2>Main</h2><div class="lnb-examples hidden"><h3>Tutorials</h3><ul><li><a href="tutorial-jest-tests.html">Jest Tests</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="jest-tests_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="CustomElement.html">CustomElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomElement_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomElement.html#handlerInProgress">handlerInProgress</a></li><li><a href="CustomElement.html#initialError">initialError</a></li><li><a href="CustomElement.html#initialErrorLabel">initialErrorLabel</a></li><li><a href="CustomElement.html#initialLoading">initialLoading</a></li><li><a href="CustomElement.html#label">label</a></li><li><a href="CustomElement.html#loading">loading</a></li><li><a href="CustomElement.html#loadingGlobal">loadingGlobal</a></li><li><a href="CustomElement.html#messages">messages</a></li><li><a href="CustomElement.html#messagesGlobal">messagesGlobal</a></li><li><a href="CustomElement.html#ready">ready</a></li><li><a href="CustomElement.html#staticData">staticData</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomElement.html#addError">addError</a></li><li><a href="CustomElement.html#addInfo">addInfo</a></li><li><a href="CustomElement.html#addSuccess">addSuccess</a></li><li><a href="CustomElement.html#addWarning">addWarning</a></li><li><a href="CustomElement.html#apex">apex</a></li><li><a href="CustomElement.html#closeWindow">closeWindow</a></li><li><a href="CustomElement.html#connectedOnceCallback">connectedOnceCallback</a></li><li><a href="CustomElement.html#dispatchAsync">dispatchAsync</a></li><li><a href="CustomElement.html#renderedOnceCallback">renderedOnceCallback</a></li></ul></div></li><li><a href="Messages.html">Messages</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Messages_sub"></div></li><li><span class="icon green">LWC</span>&nbsp;<a href="UploadFiles.html">UploadFiles</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UploadFiles_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UploadFiles.html#audioFileSize">audioFileSize</a></li><li><a href="UploadFiles.html#baseFileSize">baseFileSize</a></li><li><a href="UploadFiles.html#contentType">contentType</a></li><li><a href="UploadFiles.html#documentFileSize">documentFileSize</a></li><li><a href="UploadFiles.html#fileTypes">fileTypes</a></li><li><a href="UploadFiles.html#helpText">helpText</a></li><li><a href="UploadFiles.html#imageFileSize">imageFileSize</a></li><li><a href="UploadFiles.html#multiple">multiple</a></li><li><a href="UploadFiles.html#noZip">noZip</a></li><li><a href="UploadFiles.html#parentId">parentId</a></li><li><a href="UploadFiles.html#required">required</a></li><li><a href="UploadFiles.html#selectFileLabel">selectFileLabel</a></li><li><a href="UploadFiles.html#size">size</a></li><li><a href="UploadFiles.html#uploadFileLabel">uploadFileLabel</a></li><li><a href="UploadFiles.html#videoFileSize">videoFileSize</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UploadFiles.html#checkValidity">checkValidity</a></li><li><a href="UploadFiles.html#getErrorMessage">getErrorMessage</a></li><li><a href="UploadFiles.html#hasErrorMessage">hasErrorMessage</a></li><li><a href="UploadFiles.html#reportValidity">reportValidity</a></li><li><a href="UploadFiles.html#setCustomValidity">setCustomValidity</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="UploadFiles.html#event:upload">upload</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Mixins</h3><ul><li><a href="CustomInput.html">CustomInput</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomInput_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomInput.html#.controlClass">controlClass</a></li><li><a href="CustomInput.html#.helpMessage">helpMessage</a></li><li><a href="CustomInput.html#.required">required</a></li><li><a href="CustomInput.html#.value">value</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomInput.html#.checkValidity">checkValidity</a></li><li><a href="CustomInput.html#.getErrorMessage">getErrorMessage</a></li><li><a href="CustomInput.html#.hasErrorMessage">hasErrorMessage</a></li><li><a href="CustomInput.html#.reportValidity">reportValidity</a></li><li><a href="CustomInput.html#.setCustomValidity">setCustomValidity</a></li><li><a href="CustomInput.html#.validate">validate</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li class="hidden"><a href="global.html#Message">Message</a></li><li><a href="global.html#Severity">Severity</a></li></ul></div><h2>Testing</h2><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="JestHtmlElement.html">JestHtmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="JestHtmlElement_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="JestHtmlElement.html#.apexMock">apexMock</a></li><li><a href="JestHtmlElement.html#.dispatch">dispatch</a></li><li><a href="JestHtmlElement.html#.isApexCalled">isApexCalled</a></li><li><a href="JestHtmlElement.html#.isEventDispatched">isEventDispatched</a></li><li><a href="JestHtmlElement.html#.isGenerated">isGenerated</a></li><li><a href="JestHtmlElement.html#.isNotGenerated">isNotGenerated</a></li><li><a href="JestHtmlElement.html#.listen">listen</a></li><li><a href="JestHtmlElement.html#.mock">mock</a></li><li><a href="JestHtmlElement.html#.query">query</a></li><li><a href="JestHtmlElement.html#.queryAll">queryAll</a></li><li><a href="JestHtmlElement.html#.queryUnique">queryUnique</a></li></ul></div></li><li><a href="SharedTestHelpers.html">SharedTestHelpers</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="SharedTestHelpers.html#.staticData">staticData</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="SharedTestHelpers.html#.apexMock">apexMock</a></li><li><a href="SharedTestHelpers.html#.createComponent">createComponent</a></li><li><a href="SharedTestHelpers.html#.flushPromises">flushPromises</a></li><li><a href="SharedTestHelpers.html#.getMessages">getMessages</a></li></ul></div></li><li><a href="SharedTestHelpers.Timer.html">Timer</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SharedTestHelpers.Timer_sub"></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * The module to be used for [Jest]{@link https://jestjs.io/docs/getting-started} tests. Use it to test Lightning Web Components.
 * */

import {createElement} from 'lwc';
import CustomElement from 'c/customElement';

/**
 * @section Testing
 * @class JestHtmlElement
 * @hideconstructor
 * @extends HTMLElement
 */

/**
 *
 * @name apexMock
 * @function
 * @memberOf JestHtmlElement
 * @param actionName Name of the action we are adding a call result.
 * @param apexCallResult
 */
HTMLElement.prototype.apexMock = function (actionName, apexCallResult) {
	const mock = CustomElement.apexMock(actionName, null, this.componentClass);
	mock.mockResolvedValue(apexCallResult);
};

/**
 * Validates an Apex action was called.
 * @name isApexCalled
 * @function
 * @memberOf JestHtmlElement
 * @param actionName Name of the action we check the call of.
 * @param expectedArguments expectedArguments An object of all the arguments we expect the action was called with. Default value is null. If no argument is expected, we can set null as a value of the parameter.
 * @param occurrenceOfCall Occurrence of the call to test. Default value is 1. If the occurrenceOfCall = 0, then it means a developer doesn't expect there were any call of the Apex action.
 */
HTMLElement.prototype.isApexCalled = function (
	actionName, expectedArguments = null, occurrenceOfCall = 1) {
	
	let key = this.componentClass.name + ' - ' + actionName;
	
	let jestJn = CustomElement.actionNameToJestFnStatic[key];
	if (!jestJn) {
		jestJn = CustomElement.actionNameToJestFnStatic[actionName];
	}
	
	if (jestJn instanceof Array) {
		jestJn = jestJn[0];
	}
	
	if ((!jestJn || jestJn.mock.calls.length === 0) &amp;&amp; occurrenceOfCall) {
		throw new Error(`Apex method "${actionName}" hasn't been called yet.`);
	}
	
	if (jestJn &amp;&amp; jestJn.mock.calls.length > 0 &amp;&amp; !occurrenceOfCall) {
		throw new Error(`No one call of "${actionName}" Apex method is expected.`);
	}
	
	if (occurrenceOfCall) {
		expect(jestJn).toHaveBeenCalledTimes(occurrenceOfCall);
		
		if (expectedArguments) {
			expect(jestJn.mock.calls[occurrenceOfCall - 1][0]).toMatchObject(expectedArguments);
		}
	}
};

/**
 * Validates an event was dispatched.
 * @name isEventDispatched
 * @function
 * @memberOf JestHtmlElement
 * @param eventName Name of the event we check the dispatch of.
 * @param expectedArguments expectedArguments An object of all the arguments we expect the event was dispatched with. Default value is null. If no argument is expected, we can set null as a value of the parameter.
 * @param occurrenceOfCall Occurrence of the call to test. Default value is 1. If the occurrenceOfCall = 0, then it means a developer doesn't expect the event was dispatched.
 */
HTMLElement.prototype.isEventDispatched = function (
	eventName, expectedArguments = null, occurrenceOfCall = 1) {
	
	let jestJn = this.listenerNameToJestFn[eventName];
	
	if (!jestJn &amp;&amp; occurrenceOfCall) {
		throw new Error(`Event "${eventName}" hasn't been dispatched yet.`);
	}
	
	if (jestJn &amp;&amp; !occurrenceOfCall) {
		throw new Error(`No one call of "${eventName}" event is expected.`);
	}
	
	if (occurrenceOfCall) {
		expect(jestJn).toHaveBeenCalledTimes(occurrenceOfCall);
		
		if (expectedArguments) {
			expect(jestJn.mock.calls[occurrenceOfCall - 1][0].detail).toMatchObject(
				expectedArguments);
		}
	}
};

/**
 * Throws a Jest exception if the element of the component is not generated in HTML.
 * @name isGenerated
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of an element.
 */
HTMLElement.prototype.isGenerated = async function (selector) {
	let element = await this.query(selector);
	expect(element).not.toBe(null);
};

/**
 * Throws a Jest exception if the element of the component is generated in HTML.
 * @name isNotGenerated
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of an element.
 */
HTMLElement.prototype.isNotGenerated = async function (selector) {
	let element = await this.query(selector);
	expect(element).toBe(null);
};

/**
 * Queries an element
 * @name query
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of the element to be queried.
 * @returns {Promise&lt;JestHtmlElement>} Queried element. If the element doesn't exist, then null is returned.
 */
HTMLElement.prototype.query = async function (selector) {
	await flushAllPromises();
	
	let container = this.shadowRoot || this;
	
	return container.querySelector(selector);
};

/**
 * Queries an element and, within the same function, validates that the element exists.
 * @name queryUnique
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of the element to be queried.
 * @returns {Promise&lt;JestHtmlElement>} Queried element.
 */
HTMLElement.prototype.queryUnique = async function (selector) {
	let elements = await this.queryAll(selector);
	
	expect(elements).toHaveLength(1);
	
	return elements[0];
};

/**
 * Queries elements by selector.
 * @name queryAll
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of the elements to be queried.
 * @returns {Promise&lt;JestHtmlElement[]>} Queried elements. If no one element is found, then it returns an empty array.
 */
HTMLElement.prototype.queryAll = async function (selector) {
	await flushAllPromises();
	
	let container = this.shadowRoot || this;
	return Array.from(container.querySelectorAll(selector));
};

/**
 * @name listen
 * @function
 * @memberOf JestHtmlElement
 * @param eventName
 * @returns {Mock}
 */
HTMLElement.prototype.listen = function (eventName) {
	const mockFunction = jest.fn();
	this.addEventListener(eventName, mockFunction);
	return mockFunction;
};

/**
 * Sends an Event to the object, (synchronously) invoking the affected EventListeners
 * in the appropriate order. This is a wrapper of EventTarget.dispatchEvent()
 * designed for Jest tests which combines an event creation and dispatch operation.
 * @name dispatch
 * @function
 * @memberOf JestHtmlElement
 * @param type A string with the name of the event. It is case-sensitive.
 * @param options An object that can have the following properties: "bubbles", "cancelable",
 * "composed", "detail", "target".
 * Also, it can contain additional properties, like "dataTransfer"
 * for "drop" event, which will be available in the event object in the listeners.
 * There is also a special option "flushPromisesTimes" which can be used to set
 * how many times the flushPromises() method will be called
 * after the EventTarget.dispatchEvent() call. Default value of the "flushPromisesTimes" is 2.
 * @param selector Selector of a child element the event should be fired on. This parameter is optional. If it is not set, then the event will be dispatched for the current element.
 * @returns {Promise&lt;boolean>} Returns "false" if event.preventDefault(); was called.
 * Otherwise returns "true".
 */
HTMLElement.prototype.dispatch = async function (type, options = {}, selector) {
	options ||= {};
	
	const initOptions = [`bubbles`, `cancelable`, `composed`, `detail`];
	
	let init = {};
	for (const initOption of initOptions) {
		init[initOption] = options[initOption];
	}
	
	let event = new CustomEvent(type, init);
	for (let [name, value] of Object.entries(options)) {
		if (!initOptions.includes(name) &amp;&amp; name !== `target` &amp;&amp; name !== `flushPromisesTimes`) {
			event[name] = value;
		}
	}
	
	let element = this;
	if (selector) {
		element = await this.queryUnique(selector);
	}
	
	if (options.target) {
		for (const [name, value] of Object.entries(options.target)) {
			element[name] = value;
		}
	}
	
	const status = element.dispatchEvent(event);
	
	await flushAllPromises(options.flushPromisesTimes);
	
	return status;
};

/**
 * Mocks a function of child elements.
 * @name mock
 * @function
 * @memberOf JestHtmlElement
 * @param selector Selector of the child elements.
 * @param functionName Name of the function of the child elements to be mocked.
 * @param mockFunction A JavaScript function which will replace(mock) the default function of the elements.
 */
HTMLElement.prototype.mock = async function (selector, functionName, mockFunction) {
	let elements = await this.queryAll(selector);
	for (const element of elements) {
		element[functionName] = jest.fn().mockImplementation(mockFunction);
	}
};

async function flushAllPromises(flushPromisesTimes) {
	flushPromisesTimes ||= 2;
	
	for (let i = 0; i &lt; flushPromisesTimes; i++) {
		await flushPromises();
	}
}

/**
 * @section Testing
 * @class SharedTestHelpers
 * @hideconstructor
 */

/**
 * Creates a LWC component to be tested.
 * @memberOf SharedTestHelpers
 * @param componentName LWC component name.
 * @param componentClass Class of the LWC component.
 * @param attributes Object of values of the attributes for the LWC component's instance.
 * @param actionToResponse
 * @returns {Promise&lt;JestHtmlElement>} Returns the generated LWC component's instance.
 * */
async function createComponent(componentName, componentClass,
                               attributes = null, actionToResponse = null) {
	const element = createElement(componentName, {
		is: componentClass
	});
	
	if (attributes) {
		Object.assign(element, attributes);
	}
	
	if (actionToResponse) {
		for (const [actionName, response] of Object.entries(actionToResponse)) {
			apexMock(actionName, response);
		}
	}
	
	document.body.appendChild(element);
	
	await flushAllPromises();
	
	element.componentClass = componentClass;
	
	return element;
}

/**
 * NOTE: This function will work correctly only if you use for Apex calls
 * the CustomElement#apex function.
 *
 * @memberOf SharedTestHelpers
 * @param action
 * @param apexCallResult
 * @param emulateAsync
 * @param componentClass
 * @returns {Mock}
 */
function apexMock(action, apexCallResult = {}, emulateAsync, componentClass) {
	const mock = CustomElement.apexMock(action, emulateAsync, componentClass);
	
	typeof apexCallResult === 'function'
		? mock.mockImplementation(apexCallResult) : mock.mockResolvedValue(apexCallResult);
	
	return mock;
}

/**
 * @memberOf SharedTestHelpers
 * @param {Severity} severity
 * @returns {Message[]}
 */
function getMessages(severity = null) {
	return CustomElement.getMessages(severity);
}

/**
 * @memberOf SharedTestHelpers
 * @type {Object}
 */
const staticData = CustomElement.staticData;

/**
 * @section Testing
 * @memberOf SharedTestHelpers
 */
class Timer {
	constructor() {
		this.startTime = Math.trunc(performance.now());
	}
	
	getMilliseconds() {
		return Math.trunc(performance.now()) - this.startTime;
	}
}

/**
 * @memberOf SharedTestHelpers
 * @returns {Promise}
 */
const flushPromises = () => new Promise(resolve => {
	(typeof setImmediate === 'function' ? setImmediate : setTimeout)(resolve);
});

export {
	createComponent,
	Timer,
	apexMock,
	staticData,
	getMessages,
	flushPromises
};
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://targetrecruit.com/wp-content/uploads/2022/07/TargetRecruit_logo_purple.png" style="width: 80px; height: 13px">
    <div class="footer-text">2023</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
